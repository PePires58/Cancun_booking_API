AWSTemplateFormatVersion: "2010-09-09"
Transform: AWS::Serverless-2016-10-31
Description: Cancun Booking API Infrastructure template
Parameters:
  MaxStayDays:
    Description: Max Stay days
    Type: String
  MaxDaysBookingAdvance:
    Description: Max Days Booking Advance
    Type: String
  MinDaysBookingAdvance:
    Description: Min Days Booking Advance
    Type: String
  StageName:
    Description: Stage name
    Type: String
    Default: Prod

Resources:
  
  CancunBookingApiGateway:
    Type: AWS::Serverless::Api
    Properties:
      StageName: !Ref StageName

  PlaceReservationFunction:
    Type: AWS::Serverless::Function
    Properties:
      Description: Place Reservation Order
      FunctionName: !Sub "Cancun-Booking-${StageName}-PlaceReservation-Fn"
      Handler: "Cancun.Booking.PlaceReservation.Lambda::Cancun.Booking.PlaceReservation.Lambda.Function::FunctionHandler"
      CodeUri: src/
      Runtime: dotnet6
      Timeout: 4
      Events:
        ReservationOrder:
          Type: Api
          Properties:
            RestApiId: !Ref CancunBookingApiGateway
            Path: /ReservationOrder
            Method: POST
      Environment:
        Variables:
          MAXSTAYDAYS: !Ref MaxStayDays
          MAXDAYSBOOKINGADVANCE: !Ref MaxDaysBookingAdvance
          MINDAYSBOOKINGADVANCE: !Ref MinDaysBookingAdvance

  CancelReservationFunction:
    Type: AWS::Serverless::Function
    Properties:
      Description: Cancel Reservation Order
      FunctionName: !Sub "Cancun-Booking-${StageName}-CancelReservation-Fn"
      Handler: "Cancun.Booking.CancelReservation.Lambda::Cancun.Booking.CancelReservation.Lambda.Function::FunctionHandler"
      CodeUri: src/
      Runtime: dotnet6
      Timeout: 4
      Events:
        CancelReservationOrder:
          Type: Api
          Properties:
            RestApiId: !Ref CancunBookingApiGateway
            Path: /CancelReservationOrder
            Method: POST
      Environment:
        Variables:
          MAXSTAYDAYS: !Ref MaxStayDays
          MAXDAYSBOOKINGADVANCE: !Ref MaxDaysBookingAdvance
          MINDAYSBOOKINGADVANCE: !Ref MinDaysBookingAdvance
    
  ModifyReservationFunction:
    Type: AWS::Serverless::Function
    Properties:
      Description: Modify Reservation Order
      FunctionName: !Sub "Cancun-Booking-${StageName}-ModifyReservation-Fn"
      Handler: "Cancun.Booking.ModifyReservation.Lambda::Cancun.Booking.ModifyReservation.Lambda.Function::FunctionHandler"
      CodeUri: src/
      Runtime: dotnet6
      Timeout: 4
      Events:
        ModifyReservationOrder:
          Type: Api
          Properties:
            RestApiId: !Ref CancunBookingApiGateway
            Path: /ModifyReservationOrder
            Method: POST
      Environment:
        Variables:
          MAXSTAYDAYS: !Ref MaxStayDays
          MAXDAYSBOOKINGADVANCE: !Ref MaxDaysBookingAdvance
          MINDAYSBOOKINGADVANCE: !Ref MinDaysBookingAdvance

  CheckRoomAvailabilityFunction:
    Type: AWS::Serverless::Function
    Properties:
      Description: Check Room Availability
      FunctionName: !Sub "Cancun-Booking-${StageName}-CheckRoomAvailability-Fn"
      Handler: "Cancun.Booking.RoomAvailability.Lambda::Cancun.Booking.RoomAvailability.Lambda.Function::FunctionHandler"
      CodeUri: src/
      Runtime: dotnet6
      Timeout: 4
      Events:
        CheckRoomAvailability:
          Type: Api
          Properties:
            RestApiId: !Ref CancunBookingApiGateway
            Path: /CheckRoomAvailability
            Method: POST
      Environment:
        Variables:
          MAXSTAYDAYS: !Ref MaxStayDays
          MAXDAYSBOOKINGADVANCE: !Ref MaxDaysBookingAdvance
          MINDAYSBOOKINGADVANCE: !Ref MinDaysBookingAdvance